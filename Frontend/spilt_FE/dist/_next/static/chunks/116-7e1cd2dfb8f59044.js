"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[116],{98600:function(e,r,a){a.d(r,{Ty:function(){return t},d0:function(){return d},yE:function(){return i}});var o=a(1455),n=a(29116);let t=(0,o.hg)("auth/reissueTokens",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await n.Z.post("reissue");if("SUCCESS"===e.data.code)return{accessToken:e.data.accessToken,refreshToken:e.data.refreshToken};return a("Failed to reissue tokens")}catch(e){var o,t;return a((null===(t=e.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.message)||"Failed to reissue tokens")}}),s=(0,o.hg)("auth/logout",async(e,r)=>{let{getState:a,rejectWithValue:o}=r;try{let e=await n.Z.post("logout");if("SUCCESS"===e.data.code)return!0;return o("Failed to logout")}catch(e){var t,s;return o((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to logout")}}),l=(0,o.oM)({name:"auth",initialState:{accessToken:null,refreshToken:null,isLoading:!1,error:null},reducers:{setTokens:(e,r)=>{e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken},clearTokens:e=>{e.accessToken=null,e.refreshToken=null,e.error=null}},extraReducers:e=>{e.addCase(t.pending,e=>{e.isLoading=!0,e.error=null}).addCase(t.fulfilled,(e,r)=>{e.isLoading=!1,e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken,e.error=null}).addCase(t.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(s.fulfilled,e=>{e.accessToken=null,e.refreshToken=null,e.error=null})}}),{setTokens:d,clearTokens:i}=l.actions;r.ZP=l.reducer},99837:function(e,r,a){a.d(r,{Ky:function(){return t}});var o=a(1455),n=a(29116);let t=(0,o.hg)("device/startMeasurement",async(e,r)=>{let{rejectWithValue:a}=r;try{return await n.Z.post("device/".concat(e)),e}catch(e){var o,t,s;if((null===(o=e.response)||void 0===o?void 0:o.status)===409)return a("Device is already in use");return a((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to start measurement")}}),s=(0,o.oM)({name:"device",initialState:{isLoading:!1,error:null,currentSerial:null},reducers:{clearDeviceState:e=>{e.isLoading=!1,e.error=null,e.currentSerial=null}},extraReducers:e=>{e.addCase(t.pending,e=>{e.isLoading=!0,e.error=null}).addCase(t.fulfilled,(e,r)=>{e.isLoading=!1,e.currentSerial=r.payload,e.error=null}).addCase(t.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearDeviceState:l}=s.actions;r.ZP=s.reducer},60431:function(e,r,a){a.d(r,{A2:function(){return t},IW:function(){return u},RO:function(){return c},cJ:function(){return d},jg:function(){return l},rX:function(){return g},wR:function(){return h}});var o=a(1455),n=a(29116);let t=(0,o.hg)("frame/fetchFrames",async(e,r)=>{let{rejectWithValue:a}=r;try{let r=await n.Z.get("device/".concat(e,"/frame"));if("SUCCESS"===r.data.code)return r.data.data;return a("Failed to fetch frames")}catch(e){var o,t,s;if((null===(o=e.response)||void 0===o?void 0:o.status)===404)return a("Progress not found");return a((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to fetch frames")}}),s=(0,o.hg)("frame/uploadFrame",async(e,r)=>{let{serial:a,frameData:o}=e,{dispatch:s,rejectWithValue:l}=r;try{let e=await n.Z.post("device/".concat(a,"/frame"),o);if("SUCCESS"===e.data.code)return await s(t(a)).unwrap(),e.data;return l("Failed to upload frame")}catch(e){var d,i,u;if((null===(d=e.response)||void 0===d?void 0:d.status)===400){if("NOT_IN_PROGRESS"===e.response.data.code)return l("No measurement in progress");if("FRAME_LIMIT_REACHED"===e.response.data.code)return l("Maximum frame limit reached")}return l((null===(u=e.response)||void 0===u?void 0:null===(i=u.data)||void 0===i?void 0:i.message)||"Failed to upload frame")}}),l=(0,o.hg)("frame/skipFrame",async(e,r)=>{let{dispatch:a,rejectWithValue:o}=r;try{return await a(s({serial:e,frameData:{isSkip:!0}})).unwrap()}catch(e){return o(e)}}),d=(0,o.hg)("frame/fetchSingleFrame",async(e,r)=>{let{serial:a,frameNum:o}=e,{rejectWithValue:t}=r;try{let e=await n.Z.get("device/".concat(a,"/frame/").concat(o));if("SUCCESS"===e.data.code)return e.data.data;return t("Failed to fetch frame")}catch(e){var s,l,d;if((null===(s=e.response)||void 0===s?void 0:s.status)===404){if("PROGRESS_NOT_FOUND"===e.response.data.code)return t("Progress not found");if("FRAME_NOT_FOUND"===e.response.data.code)return t("Frame not found")}return t((null===(d=e.response)||void 0===d?void 0:null===(l=d.data)||void 0===l?void 0:l.message)||"Failed to fetch frame")}}),i=(0,o.oM)({name:"frame",initialState:{frames:[],currentFrame:null,isLoading:!1,error:null,progress:0},reducers:{clearFrames:e=>{e.frames=[],e.error=null,e.progress=0,e.currentFrame=null,sessionStorage.removeItem("frameData")},updateProgress:e=>{e.progress=Math.min(10*e.frames.length,100)},clearCurrentFrame:e=>{e.currentFrame=null},setFrames:(e,r)=>{e.frames=r.payload,e.progress=Math.min(10*r.payload.length,100)}},extraReducers:e=>{e.addCase(t.pending,e=>{e.isLoading=!0,e.error=null}).addCase(t.fulfilled,(e,r)=>{e.isLoading=!1,e.frames=r.payload,e.error=null}).addCase(t.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(s.pending,e=>{e.isLoading=!0,e.error=null}).addCase(s.fulfilled,e=>{e.isLoading=!1,e.error=null}).addCase(s.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(d.pending,e=>{e.isLoading=!0,e.error=null}).addCase(d.fulfilled,(e,r)=>{e.isLoading=!1,e.currentFrame=r.payload,e.error=null}).addCase(d.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearFrames:u,updateProgress:c,clearCurrentFrame:g,setFrames:h}=i.actions;r.ZP=i.reducer},24424:function(e,r,a){a.d(r,{Nv:function(){return s},cE:function(){return d},sP:function(){return i}});var o=a(1455),n=a(29116);let t=e=>{let r=e.map(e=>e.poseScore),a=e.map(e=>e.elbowAngleScore),o=e.map(e=>e.armStabilityScore),n=e.map(e=>e.speed);return{poseHighscore:Math.max(...r),poseLowscore:Math.min(...r),poseAvgscore:r.reduce((e,r)=>e+r,0)/e.length,elbowAngleScore:a.reduce((e,r)=>e+r,0)/e.length,armStabilityScore:o.reduce((e,r)=>e+r,0)/e.length,armSpeed:n.reduce((e,r)=>e+r,0)/e.length}},s=(0,o.hg)("game/uploadGame",async(e,r)=>{let{frames:a,bowlingScore:o}=e,{rejectWithValue:s,getState:l}=r;try{console.log("Received frames:",a),console.log("Received bowlingScore:",o);let e=l().device.currentSerial;if(!e)return s("No device connected");let r=t(a);console.log("Calculated stats:",r);let d={...r,isSkip:a.some(e=>e.isSkip)?1:0,serialNum:Number.parseInt(e),bowlingScore:o};console.log("Final gameData:",JSON.stringify(d,null,2));let i=await n.Z.post("game",d);if(console.log("API response:",i),"SUCCESS"===i.data.code)return i.data.data.id;return s("Failed to upload game")}catch(e){var d,i;return console.error("Error in uploadGame:",e),s((null===(i=e.response)||void 0===i?void 0:null===(d=i.data)||void 0===d?void 0:d.message)||"Failed to upload game")}}),l=(0,o.oM)({name:"game",initialState:{games:[],isLoading:!1,error:null,bowlingScore:null,currentGameId:null},reducers:{setBowlingScore:(e,r)=>{e.bowlingScore=r.payload},clearGameData:e=>{e.bowlingScore=null,e.currentGameId=null,e.error=null}},extraReducers:e=>{e.addCase(s.pending,e=>{e.isLoading=!0,e.error=null}).addCase(s.fulfilled,(e,r)=>{e.isLoading=!1,e.currentGameId=r.payload,e.error=null}).addCase(s.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{setBowlingScore:d,clearGameData:i}=l.actions;r.ZP=l.reducer},26637:function(e,r,a){a.d(r,{Pb:function(){return s},pn:function(){return d}});var o=a(1455),n=a(29116);let t=(0,o.hg)("user/fetchUser",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await n.Z.get("user");if("SUCCESS"===e.data.code)return console.log(e),e.data.data;return a("Failed to fetch user data")}catch(e){var o,t;return a((null===(t=e.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.message)||"Failed to fetch user data")}});(0,o.hg)("user/createUser",async(e,r)=>{let{rejectWithValue:a}=r;try{let r=await n.Z.post("user",e,{headers:{"Content-Type":"multipart/form-data"}});if("SUCCESS"===r.data.code)return console.log(r),r.data.data;return a("Failed to create user")}catch(e){var o,t;return a((null===(t=e.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.message)||"Failed to create user")}}),(0,o.hg)("user/checkNickname",async(e,r)=>{let{rejectWithValue:a}=r;try{return await n.Z.get("user/check-nickname/".concat(e)),!0}catch(e){var o,t;return a((null===(t=e.response)||void 0===t?void 0:null===(o=t.data)||void 0===o?void 0:o.message)||"Failed to check nickname")}});let s=(0,o.hg)("user/updateHighlight",async(e,r)=>{let{highlight:a,isUpdate:o}=e,{rejectWithValue:t}=r;try{let e=await (0,n.Z)({url:"/user/highlight",method:o?"PATCH":"POST",data:{highlight:a}});if("SUCCESS"===e.data.code)return a;return t(e.data.message)}catch(e){var s,l;if(null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.message)return t(e.response.data.message);return t("Failed to update highlight")}}),l=(0,o.oM)({name:"user",initialState:{user:null,isLoading:!1,error:null,highlightUpdateLoading:!1},reducers:{clearUser:e=>{e.user=null,e.error=null}},extraReducers:e=>{e.addCase(t.pending,e=>{e.isLoading=!0,e.error=null}).addCase(t.fulfilled,(e,r)=>{e.isLoading=!1,e.user=r.payload,e.error=null}).addCase(t.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(s.pending,e=>{e.highlightUpdateLoading=!0,e.error=null}).addCase(s.fulfilled,(e,r)=>{e.highlightUpdateLoading=!1,e.user&&(e.user.highlight=r.payload),e.error=null}).addCase(s.rejected,(e,r)=>{e.highlightUpdateLoading=!1,e.error=r.payload})}}),{clearUser:d}=l.actions;r.ZP=l.reducer},43953:function(e,r,a){a.d(r,{h:function(){return S}});var o=a(1455),n=a(26637),t=a(29116);let s=(0,o.hg)("theme/updateTheme",async(e,r)=>{let{rejectWithValue:a}=r;try{let r=await t.Z.patch("/user/thema",{thema:"light"===e?1:2});if("SUCCESS"===r.data.code)return e;return a("Failed to update theme")}catch(e){var o,n;return a((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.message)||"Failed to update theme")}}),l=(0,o.oM)({name:"theme",initialState:{theme:"dark",isLoading:!1,error:null},reducers:{setTheme:(e,r)=>{e.theme=r.payload}},extraReducers:e=>{e.addCase(s.pending,e=>{e.isLoading=!0,e.error=null}).addCase(s.fulfilled,(e,r)=>{e.isLoading=!1,e.theme=r.payload,e.error=null}).addCase(s.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{setTheme:d}=l.actions;var i=l.reducer,u=a(24424);let c=(0,o.hg)("ranking/fetchRankings",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await t.Z.get("rank");if("SUCCESS"===e.data.code)return e.data.data;return a("Failed to fetch rankings")}catch(e){var o,n;return a((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.message)||"Failed to fetch rankings")}}),g=(0,o.oM)({name:"ranking",initialState:{rankings:[],isLoading:!1,error:null},reducers:{clearRankings:e=>{e.rankings=[],e.error=null}},extraReducers:e=>{e.addCase(c.pending,e=>{e.isLoading=!0,e.error=null}).addCase(c.fulfilled,(e,r)=>{e.isLoading=!1,e.rankings=r.payload,e.error=null}).addCase(c.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearRankings:h}=g.actions;var p=g.reducer,f=a(98600),m=a(99837),v=a(60431);let S=(0,o.xC)({reducer:{user:n.ZP,theme:i,game:u.ZP,ranking:p,auth:f.ZP,device:m.ZP,frame:v.ZP}})},29116:function(e,r,a){var o=a(83464),n=a(43953),t=a(98600),s=a(26637);let l=["login","user/check-nickname","user","reissue","rank"],d=e=>{let r=e.startsWith("/")?e.slice(1):e;return console.log("URL 체크:",e+" : "+r),!l.some(e=>!!(e.includes("check-nickname")&&r.startsWith("user/check-nickname/"))||("user"===e?"post"===(o.Z.defaults.method||"get").toLowerCase():r===e))},i=o.Z.create({baseURL:"https://i12b202.p.ssafy.io/api",headers:{"Content-Type":"application/json"},withCredentials:!0});i.interceptors.request.use(e=>{var r;console.group("API Request"),console.log("Request URL:",e.url),console.log("Request Method:",e.method),console.log("Request Headers:",e.headers),console.log("Request Data:",e.data),console.groupEnd();let a=(null===(r=e.url)||void 0===r?void 0:r.startsWith("/"))?e.url.slice(1):e.url;if(d(a||"")){console.group("Authentication Check"),console.log("인증이 필요한 엔드포인트:",a);let r=n.h.getState().auth.accessToken;console.log("현재 저장된 액세스 토큰:",r),console.log("요청 설정:",{url:e.url,method:e.method,headers:e.headers}),r?(e.headers.Authorization=r,console.log("최종 요청 헤더:",e.headers)):console.warn("⚠️ 액세스 토큰이 없음"),console.groupEnd()}return e},e=>(console.group("Request Error"),console.error("요청 인터셉터 에러:",e),console.error("Error Config:",e.config),console.error("Error Message:",e.message),console.groupEnd(),Promise.reject(e))),i.interceptors.response.use(e=>(console.group("API Response"),console.log("Response URL:",e.config.url),console.log("Response Status:",e.status),console.log("Response Data:",e.data),console.groupEnd(),e),async e=>{var r,a,o,l,d,u,c,g;console.group("API Error"),console.error("Error Details:",{url:null===(r=e.config)||void 0===r?void 0:r.url,method:null===(a=e.config)||void 0===a?void 0:a.method,status:null===(o=e.response)||void 0===o?void 0:o.status,statusText:null===(l=e.response)||void 0===l?void 0:l.statusText,data:null===(d=e.response)||void 0===d?void 0:d.data,headers:null===(u=e.config)||void 0===u?void 0:u.headers});let h=e.config;if(h._retry)return console.warn("Request already retried - preventing infinite loop"),console.groupEnd(),Promise.reject(e);if((null===(c=e.response)||void 0===c?void 0:c.status)===403&&console.error("403 Forbidden Error:",{url:h.url,method:h.method,headers:h.headers,errorData:e.response.data}),(null===(g=e.response)||void 0===g?void 0:g.status)===401){console.log("401 Unauthorized Error:",e.response.data);let r=e.response.data.code;switch(r){case"TOKEN_EXPIRED":try{console.log("토큰 재발급 시도 시작"),h._retry=!0;let e=await n.h.dispatch((0,t.Ty)()).unwrap();return h.headers.Authorization=e.accessToken,console.log("토큰 재발급 성공:",e.accessToken),console.groupEnd(),i(h)}catch(e){return console.error("토큰 재발급 실패:",e),n.h.dispatch((0,t.yE)()),n.h.dispatch((0,s.pn)()),window.location.href="/login",console.groupEnd(),Promise.reject(e)}case"INVALID_TOKEN":case"TOKEN_MISSING":return console.error("토큰 에러: ".concat(r)),n.h.dispatch((0,t.yE)()),n.h.dispatch((0,s.pn)()),window.location.href="/login",console.groupEnd(),Promise.reject(e);default:return console.error("알 수 없는 401 에러:",r),console.groupEnd(),Promise.reject(e)}}return console.groupEnd(),Promise.reject(e)}),r.Z=i}}]);