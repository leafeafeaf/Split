"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[116],{98600:function(e,r,a){a.d(r,{Ty:function(){return d},d0:function(){return i},yE:function(){return s}});var t=a(1455),n=a(29116);let d=(0,t.hg)("auth/reissueTokens",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await n.Z.post("/reissue");if("SUCCESS"===e.data.code)return{accessToken:e.headers.authorization,refreshToken:e.headers["refresh-token"]};return a("Failed to reissue tokens")}catch(e){var t,d;return a((null===(d=e.response)||void 0===d?void 0:null===(t=d.data)||void 0===t?void 0:t.message)||"Failed to reissue tokens")}}),o=(0,t.oM)({name:"auth",initialState:{accessToken:null,refreshToken:null,isLoading:!1,error:null},reducers:{setTokens:(e,r)=>{e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken},clearTokens:e=>{e.accessToken=null,e.refreshToken=null,e.error=null}},extraReducers:e=>{e.addCase(d.pending,e=>{e.isLoading=!0,e.error=null}).addCase(d.fulfilled,(e,r)=>{e.isLoading=!1,e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken,e.error=null}).addCase(d.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{setTokens:i,clearTokens:s}=o.actions;r.ZP=o.reducer},99837:function(e,r,a){a.d(r,{Ky:function(){return d}});var t=a(1455),n=a(29116);let d=(0,t.hg)("device/startMeasurement",async(e,r)=>{let{rejectWithValue:a}=r;try{return await n.Z.post("/device/".concat(e)),e}catch(e){var t,d,o;if((null===(t=e.response)||void 0===t?void 0:t.status)===409)return a("Device is already in use");return a((null===(o=e.response)||void 0===o?void 0:null===(d=o.data)||void 0===d?void 0:d.message)||"Failed to start measurement")}}),o=(0,t.oM)({name:"device",initialState:{isLoading:!1,error:null,currentSerial:null},reducers:{clearDeviceState:e=>{e.isLoading=!1,e.error=null,e.currentSerial=null}},extraReducers:e=>{e.addCase(d.pending,e=>{e.isLoading=!0,e.error=null}).addCase(d.fulfilled,(e,r)=>{e.isLoading=!1,e.currentSerial=r.payload,e.error=null}).addCase(d.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearDeviceState:i}=o.actions;r.ZP=o.reducer},60431:function(e,r,a){a.d(r,{A2:function(){return d},IW:function(){return u},RO:function(){return c},cJ:function(){return s},jg:function(){return i},rX:function(){return g}});var t=a(1455),n=a(29116);let d=(0,t.hg)("frame/fetchFrames",async(e,r)=>{let{rejectWithValue:a}=r;try{let r=await n.Z.get("/device/".concat(e,"/frame"));if("SUCCESS"===r.data.code)return r.data.data;return a("Failed to fetch frames")}catch(e){var t,d,o;if((null===(t=e.response)||void 0===t?void 0:t.status)===404)return a("Progress not found");return a((null===(o=e.response)||void 0===o?void 0:null===(d=o.data)||void 0===d?void 0:d.message)||"Failed to fetch frames")}}),o=(0,t.hg)("frame/uploadFrame",async(e,r)=>{let{serial:a,frameData:t}=e,{dispatch:o,rejectWithValue:i}=r;try{let e=await n.Z.post("/device/".concat(a,"/frame"),t);if("SUCCESS"===e.data.code)return await o(d(a)).unwrap(),e.data;return i("Failed to upload frame")}catch(e){var s,l,u;if((null===(s=e.response)||void 0===s?void 0:s.status)===400){if("NOT_IN_PROGRESS"===e.response.data.code)return i("No measurement in progress");if("FRAME_LIMIT_REACHED"===e.response.data.code)return i("Maximum frame limit reached")}return i((null===(u=e.response)||void 0===u?void 0:null===(l=u.data)||void 0===l?void 0:l.message)||"Failed to upload frame")}}),i=(0,t.hg)("frame/skipFrame",async(e,r)=>{let{dispatch:a,rejectWithValue:t}=r;try{return await a(o({serial:e,frameData:{isSkip:!0}})).unwrap()}catch(e){return t(e)}}),s=(0,t.hg)("frame/fetchSingleFrame",async(e,r)=>{let{serial:a,frameNum:t}=e,{rejectWithValue:d}=r;try{let e=await n.Z.get("/device/".concat(a,"/frame/").concat(t));if("SUCCESS"===e.data.code)return e.data.data;return d("Failed to fetch frame")}catch(e){var o,i,s;if((null===(o=e.response)||void 0===o?void 0:o.status)===404){if("PROGRESS_NOT_FOUND"===e.response.data.code)return d("Progress not found");if("FRAME_NOT_FOUND"===e.response.data.code)return d("Frame not found")}return d((null===(s=e.response)||void 0===s?void 0:null===(i=s.data)||void 0===i?void 0:i.message)||"Failed to fetch frame")}}),l=(0,t.oM)({name:"frame",initialState:{frames:[],currentFrame:null,isLoading:!1,error:null,progress:0},reducers:{clearFrames:e=>{e.frames=[],e.error=null,e.progress=0,e.currentFrame=null},updateProgress:e=>{e.progress=Math.min(10*e.frames.length,100)},clearCurrentFrame:e=>{e.currentFrame=null}},extraReducers:e=>{e.addCase(d.pending,e=>{e.isLoading=!0,e.error=null}).addCase(d.fulfilled,(e,r)=>{e.isLoading=!1,e.frames=r.payload,e.error=null}).addCase(d.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(o.pending,e=>{e.isLoading=!0,e.error=null}).addCase(o.fulfilled,e=>{e.isLoading=!1,e.error=null}).addCase(o.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(s.pending,e=>{e.isLoading=!0,e.error=null}).addCase(s.fulfilled,(e,r)=>{e.isLoading=!1,e.currentFrame=r.payload,e.error=null}).addCase(s.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearFrames:u,updateProgress:c,clearCurrentFrame:g}=l.actions;r.ZP=l.reducer},24424:function(e,r,a){a.d(r,{Nv:function(){return o},cE:function(){return s},sP:function(){return l}});var t=a(1455),n=a(29116);let d=e=>{let r=e.map(e=>e.poseScore),a=e.map(e=>e.elbowAngleScore),t=e.map(e=>e.armStabilityScore),n=e.map(e=>e.speed);return{poseHighscore:Math.max(...r),poseLowscore:Math.min(...r),poseAvgscore:r.reduce((e,r)=>e+r,0)/e.length,elbowAngleScore:a.reduce((e,r)=>e+r,0)/e.length,armStabilityScore:t.reduce((e,r)=>e+r,0)/e.length,armSpeed:n.reduce((e,r)=>e+r,0)/e.length}},o=(0,t.hg)("game/uploadGame",async(e,r)=>{let{frames:a,bowlingScore:t}=e,{rejectWithValue:o}=r;try{let e={...d(a),isSkip:a.some(e=>e.isSkip)?1:0,serialNum:1,bowlingScore:t},r=await n.Z.post("/game",e);if("SUCCESS"===r.data.code)return r.data.data.id;return o("Failed to upload game")}catch(e){var i,s;return o((null===(s=e.response)||void 0===s?void 0:null===(i=s.data)||void 0===i?void 0:i.message)||"Failed to upload game")}}),i=(0,t.oM)({name:"game",initialState:{games:[],isLoading:!1,error:null,bowlingScore:null,currentGameId:null},reducers:{setBowlingScore:(e,r)=>{e.bowlingScore=r.payload},clearGameData:e=>{e.bowlingScore=null,e.currentGameId=null,e.error=null}},extraReducers:e=>{e.addCase(o.pending,e=>{e.isLoading=!0,e.error=null}).addCase(o.fulfilled,(e,r)=>{e.isLoading=!1,e.currentGameId=r.payload,e.error=null}).addCase(o.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{setBowlingScore:s,clearGameData:l}=i.actions;r.ZP=i.reducer},26637:function(e,r,a){a.d(r,{Pb:function(){return o},pn:function(){return s}});var t=a(1455),n=a(29116);let d=(0,t.hg)("user/fetchUser",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await n.Z.get("/user");if("SUCCESS"===e.data.code)return e.data.data;return a("Failed to fetch user data")}catch(e){var t,d;return a((null===(d=e.response)||void 0===d?void 0:null===(t=d.data)||void 0===t?void 0:t.message)||"Failed to fetch user data")}}),o=(0,t.hg)("user/updateHighlight",async(e,r)=>{let{highlight:a,isUpdate:t}=e,{rejectWithValue:d}=r;try{let e=await (0,n.Z)({method:t?"patch":"post",url:"/user/highlight",data:{highlight:a}});if("SUCCESS"===e.data.code)return a;return d("Failed to update highlight")}catch(e){var o,i,s;if((null===(o=e.response)||void 0===o?void 0:o.status)===400&&"INVALID_VIDEO_URL"===e.response.data.code)return d("Invalid video URL format");return d((null===(s=e.response)||void 0===s?void 0:null===(i=s.data)||void 0===i?void 0:i.message)||"Failed to update highlight")}}),i=(0,t.oM)({name:"user",initialState:{user:null,isLoading:!1,error:null,highlightUpdateLoading:!1},reducers:{clearUser:e=>{e.user=null,e.error=null}},extraReducers:e=>{e.addCase(d.pending,e=>{e.isLoading=!0,e.error=null}).addCase(d.fulfilled,(e,r)=>{e.isLoading=!1,e.user=r.payload,e.error=null}).addCase(d.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(o.pending,e=>{e.highlightUpdateLoading=!0,e.error=null}).addCase(o.fulfilled,(e,r)=>{e.highlightUpdateLoading=!1,e.user&&(e.user.highlight=r.payload),e.error=null}).addCase(o.rejected,(e,r)=>{e.highlightUpdateLoading=!1,e.error=r.payload})}}),{clearUser:s}=i.actions;r.ZP=i.reducer},43953:function(e,r,a){a.d(r,{h:function(){return y}});var t=a(1455),n=a(26637),d=a(29116);let o=(0,t.hg)("theme/updateTheme",async(e,r)=>{let{rejectWithValue:a}=r;try{let r=await d.Z.patch("/user/thema",{thema:"light"===e?1:2});if("SUCCESS"===r.data.code)return e;return a("Failed to update theme")}catch(e){var t,n;return a((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to update theme")}}),i=(0,t.oM)({name:"theme",initialState:{theme:"dark",isLoading:!1,error:null},reducers:{setTheme:(e,r)=>{e.theme=r.payload}},extraReducers:e=>{e.addCase(o.pending,e=>{e.isLoading=!0,e.error=null}).addCase(o.fulfilled,(e,r)=>{e.isLoading=!1,e.theme=r.payload,e.error=null}).addCase(o.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{setTheme:s}=i.actions;var l=i.reducer,u=a(24424);let c=(0,t.hg)("ranking/fetchRankings",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await d.Z.get("/rank");if("SUCCESS"===e.data.code)return e.data.data;return a("Failed to fetch rankings")}catch(e){var t,n;return a((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to fetch rankings")}}),g=(0,t.oM)({name:"ranking",initialState:{rankings:[],isLoading:!1,error:null},reducers:{clearRankings:e=>{e.rankings=[],e.error=null}},extraReducers:e=>{e.addCase(c.pending,e=>{e.isLoading=!0,e.error=null}).addCase(c.fulfilled,(e,r)=>{e.isLoading=!1,e.rankings=r.payload,e.error=null}).addCase(c.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearRankings:h}=g.actions;var p=g.reducer,f=a(98600),m=a(99837),v=a(60431);let y=(0,t.xC)({reducer:{user:n.ZP,theme:l,game:u.ZP,ranking:p,auth:f.ZP,device:m.ZP,frame:v.ZP}})},29116:function(e,r,a){var t=a(83464),n=a(43953),d=a(98600),o=a(26637);let i=t.Z.create({baseURL:"https://i12b202.p.ssafy.io/api",headers:{"Content-Type":"application/json"},withCredentials:!0});i.interceptors.request.use(e=>{let r=n.h.getState().auth.accessToken;return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,async e=>{var r;let a=e.config;if(a._retry)return Promise.reject(e);if((null===(r=e.response)||void 0===r?void 0:r.status)===401)switch(e.response.data.code){case"TOKEN_EXPIRED":try{a._retry=!0;let e=await n.h.dispatch((0,d.Ty)()).unwrap();return a.headers.Authorization="Bearer ".concat(e.accessToken),i(a)}catch(e){return n.h.dispatch((0,d.yE)()),n.h.dispatch((0,o.pn)()),window.location.href="/login",Promise.reject(e)}case"INVALID_TOKEN":case"TOKEN_MISSING":n.h.dispatch((0,d.yE)()),n.h.dispatch((0,o.pn)()),window.location.href="/login"}return Promise.reject(e)}),r.Z=i}}]);