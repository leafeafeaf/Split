"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[116],{98600:function(e,r,a){a.d(r,{Ty:function(){return n},d0:function(){return d},yE:function(){return i}});var t=a(1455),o=a(29116);let n=(0,t.hg)("auth/reissueTokens",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await o.Z.post("reissue");if("SUCCESS"===e.data.code)return{accessToken:e.data.accessToken,refreshToken:e.data.refreshToken};return a("Failed to reissue tokens")}catch(e){var t,n;return a((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to reissue tokens")}}),l=(0,t.hg)("auth/logout",async(e,r)=>{let{getState:a,rejectWithValue:t}=r;try{let e=await o.Z.post("logout");if("SUCCESS"===e.data.code)return!0;return t("Failed to logout")}catch(e){var n,l;return t((null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||"Failed to logout")}}),s=(0,t.oM)({name:"auth",initialState:{accessToken:null,refreshToken:null,isLoading:!1,error:null},reducers:{setTokens:(e,r)=>{e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken},clearTokens:e=>{e.accessToken=null,e.refreshToken=null,e.error=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,r)=>{e.isLoading=!1,e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken,e.error=null}).addCase(n.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(l.fulfilled,e=>{e.accessToken=null,e.refreshToken=null,e.error=null})}}),{setTokens:d,clearTokens:i}=s.actions;r.ZP=s.reducer},99837:function(e,r,a){a.d(r,{Ky:function(){return n}});var t=a(1455),o=a(29116);let n=(0,t.hg)("device/startMeasurement",async(e,r)=>{let{rejectWithValue:a}=r;try{return await o.Z.post("device/".concat(e)),e}catch(e){var t,n,l;if((null===(t=e.response)||void 0===t?void 0:t.status)===409)return a("Device is already in use");return a((null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||"Failed to start measurement")}}),l=(0,t.oM)({name:"device",initialState:{isLoading:!1,error:null,currentSerial:null},reducers:{clearDeviceState:e=>{e.isLoading=!1,e.error=null,e.currentSerial=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,r)=>{e.isLoading=!1,e.currentSerial=r.payload,e.error=null}).addCase(n.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearDeviceState:s}=l.actions;r.ZP=l.reducer},60431:function(e,r,a){a.d(r,{A2:function(){return n},IW:function(){return u},RO:function(){return c},cJ:function(){return d},jg:function(){return s},rX:function(){return g},wR:function(){return h}});var t=a(1455),o=a(29116);let n=(0,t.hg)("frame/fetchFrames",async(e,r)=>{let{rejectWithValue:a}=r;try{let r=await o.Z.get("device/".concat(e,"/frame"));if("SUCCESS"===r.data.code)return r.data.data;return a("Failed to fetch frames")}catch(e){var t,n,l;if((null===(t=e.response)||void 0===t?void 0:t.status)===404)return a("Progress not found");return a((null===(l=e.response)||void 0===l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||"Failed to fetch frames")}}),l=(0,t.hg)("frame/uploadFrame",async(e,r)=>{let{serial:a,frameData:t}=e,{dispatch:l,rejectWithValue:s}=r;try{let e=await o.Z.post("device/".concat(a,"/frame"),t);if("SUCCESS"===e.data.code)return await l(n(a)).unwrap(),e.data;return s("Failed to upload frame")}catch(e){var d,i,u;if((null===(d=e.response)||void 0===d?void 0:d.status)===400){if("NOT_IN_PROGRESS"===e.response.data.code)return s("No measurement in progress");if("FRAME_LIMIT_REACHED"===e.response.data.code)return s("Maximum frame limit reached")}return s((null===(u=e.response)||void 0===u?void 0:null===(i=u.data)||void 0===i?void 0:i.message)||"Failed to upload frame")}}),s=(0,t.hg)("frame/skipFrame",async(e,r)=>{let{dispatch:a,rejectWithValue:t}=r;try{return await a(l({serial:e,frameData:{isSkip:!0}})).unwrap()}catch(e){return t(e)}}),d=(0,t.hg)("frame/fetchSingleFrame",async(e,r)=>{let{serial:a,frameNum:t}=e,{rejectWithValue:n}=r;try{let e=await o.Z.get("device/".concat(a,"/frame/").concat(t));if("SUCCESS"===e.data.code)return e.data.data;return n("Failed to fetch frame")}catch(e){var l,s,d;if((null===(l=e.response)||void 0===l?void 0:l.status)===404){if("PROGRESS_NOT_FOUND"===e.response.data.code)return n("Progress not found");if("FRAME_NOT_FOUND"===e.response.data.code)return n("Frame not found")}return n((null===(d=e.response)||void 0===d?void 0:null===(s=d.data)||void 0===s?void 0:s.message)||"Failed to fetch frame")}}),i=(0,t.oM)({name:"frame",initialState:{frames:[],currentFrame:null,isLoading:!1,error:null,progress:0},reducers:{clearFrames:e=>{e.frames=[],e.error=null,e.progress=0,e.currentFrame=null,sessionStorage.removeItem("frameData")},updateProgress:e=>{e.progress=Math.min(10*e.frames.length,100)},clearCurrentFrame:e=>{e.currentFrame=null},setFrames:(e,r)=>{e.frames=r.payload,e.progress=Math.min(10*r.payload.length,100)}},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,r)=>{e.isLoading=!1,e.frames=r.payload,e.error=null}).addCase(n.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(l.fulfilled,e=>{e.isLoading=!1,e.error=null}).addCase(l.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(d.pending,e=>{e.isLoading=!0,e.error=null}).addCase(d.fulfilled,(e,r)=>{e.isLoading=!1,e.currentFrame=r.payload,e.error=null}).addCase(d.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearFrames:u,updateProgress:c,clearCurrentFrame:g,setFrames:h}=i.actions;r.ZP=i.reducer},24424:function(e,r,a){a.d(r,{Nv:function(){return l},cE:function(){return d},sP:function(){return i}});var t=a(1455),o=a(29116);let n=e=>{let r=e.map(e=>e.poseScore),a=e.map(e=>e.elbowAngleScore),t=e.map(e=>e.armStabilityScore),o=e.map(e=>e.speed);return{poseHighscore:Math.max(...r),poseLowscore:Math.min(...r),poseAvgscore:r.reduce((e,r)=>e+r,0)/e.length,elbowAngleScore:a.reduce((e,r)=>e+r,0)/e.length,armStabilityScore:t.reduce((e,r)=>e+r,0)/e.length,armSpeed:o.reduce((e,r)=>e+r,0)/e.length}},l=(0,t.hg)("game/uploadGame",async(e,r)=>{let{frames:a,bowlingScore:t}=e,{rejectWithValue:l,getState:s}=r;try{console.log("Received frames:",a),console.log("Received bowlingScore:",t);let e=s().device.currentSerial;if(!e)return l("No device connected");let r=n(a);console.log("Calculated stats:",r);let d={...r,isSkip:a.some(e=>e.isSkip)?1:0,serialNum:Number.parseInt(e),bowlingScore:t};console.log("Final gameData:",JSON.stringify(d,null,2));let i=await o.Z.post("game",d);if(console.log("API response:",i),"SUCCESS"===i.data.code)return i.data.data.id;return l("Failed to upload game")}catch(e){var d,i;return console.error("Error in uploadGame:",e),l((null===(i=e.response)||void 0===i?void 0:null===(d=i.data)||void 0===d?void 0:d.message)||"Failed to upload game")}}),s=(0,t.oM)({name:"game",initialState:{games:[],isLoading:!1,error:null,bowlingScore:null,currentGameId:null},reducers:{setBowlingScore:(e,r)=>{e.bowlingScore=r.payload},clearGameData:e=>{e.bowlingScore=null,e.currentGameId=null,e.error=null}},extraReducers:e=>{e.addCase(l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(l.fulfilled,(e,r)=>{e.isLoading=!1,e.currentGameId=r.payload,e.error=null}).addCase(l.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{setBowlingScore:d,clearGameData:i}=s.actions;r.ZP=s.reducer},26637:function(e,r,a){a.d(r,{Pb:function(){return l},pn:function(){return d}});var t=a(1455),o=a(29116);let n=(0,t.hg)("user/fetchUser",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await o.Z.get("user");if("SUCCESS"===e.data.code)return console.log(e),e.data.data;return a("Failed to fetch user data")}catch(e){var t,n;return a((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to fetch user data")}});(0,t.hg)("user/createUser",async(e,r)=>{let{rejectWithValue:a}=r;try{let r=await o.Z.post("user",e,{headers:{"Content-Type":"multipart/form-data"}});if("SUCCESS"===r.data.code)return console.log(r),r.data.data;return a("Failed to create user")}catch(e){var t,n;return a((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to create user")}}),(0,t.hg)("user/checkNickname",async(e,r)=>{let{rejectWithValue:a}=r;try{return await o.Z.get("user/check-nickname/".concat(e)),!0}catch(e){var t,n;return a((null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to check nickname")}});let l=(0,t.hg)("user/updateHighlight",async(e,r)=>{let{highlight:a,isUpdate:t}=e,{rejectWithValue:n}=r;try{let e=await (0,o.Z)({method:t?"patch":"post",url:"user/highlight",data:{highlight:a}});if("SUCCESS"===e.data.code)return console.log(e),a;return n("Failed to update highlight")}catch(e){var l,s,d;if((null===(l=e.response)||void 0===l?void 0:l.status)===400&&"INVALID_VIDEO_URL"===e.response.data.code)return n("Invalid video URL format");return n((null===(d=e.response)||void 0===d?void 0:null===(s=d.data)||void 0===s?void 0:s.message)||"Failed to update highlight")}}),s=(0,t.oM)({name:"user",initialState:{user:null,isLoading:!1,error:null,highlightUpdateLoading:!1},reducers:{clearUser:e=>{e.user=null,e.error=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,r)=>{e.isLoading=!1,e.user=r.payload,e.error=null}).addCase(n.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(l.pending,e=>{e.highlightUpdateLoading=!0,e.error=null}).addCase(l.fulfilled,(e,r)=>{e.highlightUpdateLoading=!1,e.user&&(e.user.highlight=r.payload),e.error=null}).addCase(l.rejected,(e,r)=>{e.highlightUpdateLoading=!1,e.error=r.payload})}}),{clearUser:d}=s.actions;r.ZP=s.reducer},43953:function(e,r,a){a.d(r,{h:function(){return y}});var t=a(1455),o=a(26637),n=a(29116);let l=(0,t.hg)("theme/updateTheme",async(e,r)=>{let{rejectWithValue:a}=r;try{let r=await n.Z.patch("/user/thema",{thema:"light"===e?1:2});if("SUCCESS"===r.data.code)return e;return a("Failed to update theme")}catch(e){var t,o;return a((null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.message)||"Failed to update theme")}}),s=(0,t.oM)({name:"theme",initialState:{theme:"dark",isLoading:!1,error:null},reducers:{setTheme:(e,r)=>{e.theme=r.payload}},extraReducers:e=>{e.addCase(l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(l.fulfilled,(e,r)=>{e.isLoading=!1,e.theme=r.payload,e.error=null}).addCase(l.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{setTheme:d}=s.actions;var i=s.reducer,u=a(24424);let c=(0,t.hg)("ranking/fetchRankings",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=await n.Z.get("rank");if("SUCCESS"===e.data.code)return e.data.data;return a("Failed to fetch rankings")}catch(e){var t,o;return a((null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.message)||"Failed to fetch rankings")}}),g=(0,t.oM)({name:"ranking",initialState:{rankings:[],isLoading:!1,error:null},reducers:{clearRankings:e=>{e.rankings=[],e.error=null}},extraReducers:e=>{e.addCase(c.pending,e=>{e.isLoading=!0,e.error=null}).addCase(c.fulfilled,(e,r)=>{e.isLoading=!1,e.rankings=r.payload,e.error=null}).addCase(c.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload})}}),{clearRankings:h}=g.actions;var p=g.reducer,f=a(98600),m=a(99837),v=a(60431);let y=(0,t.xC)({reducer:{user:o.ZP,theme:i,game:u.ZP,ranking:p,auth:f.ZP,device:m.ZP,frame:v.ZP}})},29116:function(e,r,a){var t=a(83464),o=a(43953),n=a(98600),l=a(26637);let s=["login","user/check-nickname","user","reissue","rank"],d=e=>{let r=e.startsWith("/")?e.slice(1):e;return console.log("URL 체크:",e+" : "+r),!s.some(e=>!!(e.includes("check-nickname")&&r.startsWith("user/check-nickname/"))||("user"===e?"post"===(t.Z.defaults.method||"get").toLowerCase():r===e))},i=t.Z.create({baseURL:"https://i12b202.p.ssafy.io/api",headers:{"Content-Type":"application/json"},withCredentials:!0});i.interceptors.request.use(e=>{var r;console.log("전체 요청 설정:",e);let a=(null===(r=e.url)||void 0===r?void 0:r.startsWith("/"))?e.url.slice(1):e.url;if(d(a||"")){console.log("인증이 필요한 엔드포인트:",a);let r=o.h.getState().auth.accessToken;console.log("현재 저장된 액세스 토큰:",r),console.log("요청 설정:",{url:e.url,method:e.method,headers:e.headers}),r?(e.headers.Authorization=r,console.log("최종 요청 헤더:",e.headers)):console.log("액세스 토큰이 없음")}return e},e=>(console.log("요청 인터셉터 에러:",e),Promise.reject(e))),i.interceptors.response.use(e=>e,async e=>{var r,a;let t=e.config;if(t._retry)return Promise.reject(e);if((null===(r=e.response)||void 0===r?void 0:r.status)===403&&console.log("403 Forbidden 에러 발생:",{url:t.url,method:t.method,headers:t.headers,errorData:e.response.data}),(null===(a=e.response)||void 0===a?void 0:a.status)===401)switch(console.log("401 에러 발생:",e.response.data),e.response.data.code){case"TOKEN_EXPIRED":try{console.log("토큰 재발급 시도"),t._retry=!0;let e=await o.h.dispatch((0,n.Ty)()).unwrap();return t.headers.Authorization=e.accessToken,console.log("토큰 재발급 성공:",e.accessToken),i(t)}catch(e){return console.log("토큰 재발급 실패:",e),o.h.dispatch((0,n.yE)()),o.h.dispatch((0,l.pn)()),window.location.href="/login",Promise.reject(e)}case"INVALID_TOKEN":case"TOKEN_MISSING":console.log("토큰 무효 또는 누락"),o.h.dispatch((0,n.yE)()),o.h.dispatch((0,l.pn)()),window.location.href="/login"}return Promise.reject(e)}),r.Z=i}}]);